# Example NGINX config for SwiftTrack API Gateway
# Place this file in infra/gateway/nginx.conf
# Update docker-compose.yml to mount this config and expose port 8080

worker_processes 1;
events { worker_connections 1024; }
http {
    upstream order_api { server order-api:3000; }
    upstream cms_adapter { server cms-adapter:3000; }
    upstream wms_adapter { server wms-adapter:3000; }
    upstream ros_adapter { server ros-adapter:3000; }
    upstream notification { server notification:3000; }
    upstream delivery { server delivery:3000; }

    upstream client_portal { server client-portal:5000; }
    upstream driver_app { server driver-app:5001; }

    server {
        listen 80;
        # Route API requests to services
        location /api/orders/ {
            proxy_pass http://order_api/;
        }
        location /api/cms/ {
            proxy_pass http://cms_adapter/;
        }
        location /api/wms/ {
            proxy_pass http://wms_adapter/;
        }
        location /api/ros/ {
            proxy_pass http://ros_adapter/;
        }
        location /api/notify/ {
            proxy_pass http://notification/;
        }
        location /api/delivery/ {
            proxy_pass http://delivery/;
        }
        # Route frontend apps through gateway
        location /client/ {
            proxy_pass http://client_portal/;
            proxy_set_header Host $host;
        }
        location /driver/ {
            proxy_pass http://driver_app/;
            proxy_set_header Host $host;
        }
    }
}
